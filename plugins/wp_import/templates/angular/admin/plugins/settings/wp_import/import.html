<script type="text/javascript">
	angular.module('pencilblueApp', ['ngFileUpload'])
	.controller('PencilBlueController', function($scope, $http, Upload, $window) {
		^angular_objects^

		$scope.onFileSelect = function($files) {
			for (var i = 0; i < $files.length && i < 1; i++) {
				var file = $files[i];
				$scope.uploading = true;
				$scope.uploadPercent = 0;
				$scope.upload = Upload.upload({
					url: '/actions/admin/plugins/wp_import/settings/import',
					data: { file: file }
				}).progress(function(evt) {
					$scope.uploadPercent = parseInt(100.0 * evt.loaded / evt.total);
				}).success(function(data, status, headers, config) {
					$scope.successMessage = data.message;
					$scope.uploading = false;
					$window.location = '/admin/plugins/wp_import/settings/manage_new_users';
				}).error(function(data, status) {
					$scope.errorMessage = data.message;
					$scope.uploading = false;
				});
			}
		};
	});
</script>
